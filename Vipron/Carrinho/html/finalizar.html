<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../../Carrinho/css/style.css">
<title>Finalizar Compra</title>

</head>
<body>
<header>
    <div class="logo">
      <a href="../../Inicio/html/index.html">             <img src="../../Inicio/img/header/logo.png" alt="Vipron Store Logo"></a>
    </div>

    <nav>
        <ul>
            <li><a href="../../Produtos/html/produtos.html">Produtos</a></li>
            <li><a href="../../Contatos/html/contato.html">Contato</a></li>
            <li><a href="../../Login/html/cadastro.html" class="bt-cadastro">Cadastro</a></li>
            <li class="cart-icon">
                <a href="../../Carrinho/html/carrinho.html">
                    <img src="../../Inicio/img/header/carrinho.png" alt="Carrinho">
                    <span class="cart-badge">0</span>
                </a>
            </li>
        </ul>
    </nav>
</header>

<section class="finalizar-container">
  <h1 class="titulo-finalizar">Finalizar Compra</h1>
  <p class="sub-finalizar">Revise seus dados e conclua seu pedido</p>

  <div class="checkout-grid">

    <!-- ================= FORMUL√ÅRIO ================= -->
    <div class="checkout-form">

      <h2 class="titulo-secao">üìç Endere√ßo de Entrega</h2>

<label>Nome Completo</label>
<input type="text" placeholder="Digite seu nome completo">

<label>CEP</label>
<input type="text" placeholder="00000-000">

<label>Endere√ßo</label>
<input type="text" placeholder="Rua">

<label>N√∫mero</label>
<input type="text" placeholder="N√∫mero">

<label>Bairro</label>
<input type="text" placeholder="Bairro">

<label>Cidade</label>
<input type="text" placeholder="Cidade">

<label>Estado</label>
<input type="text" placeholder="Estado">

<label>Telefone</label>
<input type="text" placeholder="(00) 00000-0000">


      <h2 class="titulo-secao">üí≥ Forma de Pagamento</h2>

      <div class="pagamento-opcoes">

        <label class="pag-option">
          <input type="radio" name="pagamento" value="pix">
          <div class="pag-card">
            <img class="pag-img" src="https://upload.wikimedia.org/wikipedia/commons/0/04/Logo_Pix.png">
            <span>Pix</span>
          </div>
        </label>

        <label class="pag-option">
          <input type="radio" name="pagamento" value="cartao">
          <div class="pag-card">
            <img class="pag-img" src="https://upload.wikimedia.org/wikipedia/commons/0/0d/Mastercard-logo.png">
            <span>Cart√£o de Cr√©dito</span>
          </div>
        </label>

        <label class="pag-option">
          <input type="radio" name="pagamento" value="boleto">
          <div class="pag-card">
            <img class="pag-img" src="https://cdn-icons-png.flaticon.com/512/6064/6064930.png">
            <span>Boleto Banc√°rio</span>
          </div>
        </label>

      </div>

      <button class="btn-finalizar btn-resumo">Finalizar Compra</button>

    </div>

    <!-- ================= RESUMO DO PEDIDO ================= -->
    <div class="checkout-resumo">
      <h2 class="titulo-secao">Resumo do Pedido</h2>

      <div id="lista-pedido"></div>

      <div class="linha-resumo">
        <span>Subtotal</span>
        <strong id="subtotal">R$ 0,00</strong>
      </div>

      <div class="linha-resumo">
        <span>Frete</span>
        <strong>Gr√°tis</strong>
      </div>

      <div class="total-final">
        <span>Total</span>
        <strong id="total">R$ 0,00</strong>
      </div>
    </div>

  </div>
</section>

<!-- ================= MODAIS ================= -->

<!-- Modal Pagamento -->
<div id="modalPagamento">
  <div id="conteudoPagamento"></div>
</div>

<!-- Loading -->
<div id="modalLoading">
  <div class="loader"></div>
</div>

<!-- Final -->
<div id="modalFinal">
  ‚úî Pagamento Conclu√≠do!
</div>

<footer>
  <div class="footer-section">
    <h3>Contato</h3>
    <p>Email: contato@vipronstore.com</p>
    <p>Telefone: (11) 1234-5678</p>
  </div>

  <div class="footer-section">
    <h3>Links √öteis</h3>
    <a href="#">Pol√≠tica de Privacidade</a><br>
    <a href="#">Quem Somos</a><br>
    <a href="#">Cadastrar/Entrar</a><br>
    <a href="#">Meu Carrinho</a><br>
  </div>

  <div class="footer-section">
    <h3>Copyright</h3>
    <p>&copy; 2025 Vipron - Todos os direitos reservados</p>
  </div>
</footer>
<script>
// =========================================
// FUN√á√ÉO DE NOTIFICA√á√ÉO BONITA
// =========================================
function mostrarErro(msg) {
  const div = document.createElement("div");
  div.className = "notificacao-erro";
  div.textContent = msg;

  document.body.appendChild(div);

  setTimeout(() => div.classList.add("mostrar"), 50);

  setTimeout(() => {
    div.classList.remove("mostrar");
    setTimeout(() => div.remove(), 400);
  }, 3000);
}

// =========================================
// CARREGAR OS PRODUTOS DO LOCALSTORAGE
// =========================================
function carregarResumoPedido() {
  const listaDiv = document.getElementById("lista-pedido");
  const subtotalEl = document.getElementById("subtotal");
  const totalEl = document.getElementById("total");

  let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

  listaDiv.innerHTML = "";
  let subtotal = 0;

  carrinho.forEach(item => {
    let totalItem = item.preco * item.quantidade;
    subtotal += totalItem;

    listaDiv.innerHTML += `
      <div class="resumo-produto">
        <img src="${item.imagem}">
        <div>
          <h4>${item.nome}</h4>
          <p>Quantidade: ${item.quantidade}</p>
          <p>Pre√ßo: R$ ${totalItem.toFixed(2)}</p>
        </div>
      </div>
    `;
  });

  subtotalEl.textContent = `R$ ${subtotal.toFixed(2)}`;
  totalEl.textContent = `R$ ${subtotal.toFixed(2)}`;
}

window.onload = carregarResumoPedido;

// =========================================
// VALIDAR FORMUL√ÅRIO ANTES DE PAGAR
// =========================================
function validarFormulario() {
  const camposObrigatorios = [
    "Digite seu nome completo",
    "00000-000",
    "Rua",
    "N√∫mero",
    "Bairro",
    "Cidade",
    "Estado",
    "(00) 00000-0000"
  ];

  for (let placeholder of camposObrigatorios) {
    const campo = [...document.querySelectorAll("input")]
      .find(i => i.placeholder === placeholder);

    if (campo && campo.value.trim() === "") {
      mostrarErro(`Preencha o campo: ${placeholder}`);
      campo.focus();
      return false;
    }
  }

  return true;
}

// =========================================
// FINALIZAR COMPRA
// =========================================
document.querySelector(".btn-resumo").addEventListener("click", () => {

  if (!validarFormulario()) return;

  const metodo = document.querySelector('input[name="pagamento"]:checked');

  if (!metodo) {
    mostrarErro("Selecione um m√©todo de pagamento!");
    return;
  }

  abrirPagamento(metodo.value);
});

// =========================================
// MODAL DO PAGAMENTO
// =========================================
function abrirPagamento(tipo) {
  const modal = document.getElementById("modalPagamento");
  const conteudo = document.getElementById("conteudoPagamento");

  modal.style.display = "flex";

  if (tipo === "pix") {
    conteudo.innerHTML = `
      <h2>Pagamento via PIX</h2>
      <p>Escaneie o QR Code abaixo:</p>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=Pagamento%20PIX"/>
      <button id="prosseguirBtn">Prosseguir</button>
    `;
  }

  else if (tipo === "cartao") {
    conteudo.innerHTML = `
      <h2>Pagamento com Cart√£o</h2>
      <label>N√∫mero do Cart√£o</label>
      <input type="text" placeholder="0000 0000 0000 0000">
      <label>Validade</label>
      <input type="text" placeholder="MM/AA">
      <label>CVV</label>
      <input type="text" placeholder="123">
      <button id="prosseguirBtn">Prosseguir</button>
    `;
  }

  else {
    const num = Math.floor(100000000000000 + Math.random() * 900000000000000);
    conteudo.innerHTML = `
      <h2>Boleto Gerado</h2>
      <p>Linha Digit√°vel:</p>
      <strong>${num}</strong>
      <button id="prosseguirBtn">Prosseguir</button>
    `;
  }

  document.getElementById("prosseguirBtn").addEventListener("click", iniciarProcessoPagamento);
}

// =========================================
// ANIMA√á√ÉO DE CARREGAMENTO
// =========================================
function iniciarProcessoPagamento() {
  document.getElementById("modalPagamento").style.display = "none";
  document.getElementById("modalLoading").style.display = "flex";

  setTimeout(() => {
    document.getElementById("modalLoading").style.display = "none";
    pagamentoConcluido();
  }, 3000);
}

// =========================================
// PAGAMENTO FINAL
// =========================================
function pagamentoConcluido() {
  const final = document.getElementById("modalFinal");
  final.style.display = "flex";

  localStorage.removeItem("carrinho");

  setTimeout(() => {
    window.location.href = "../../Inicio/html/index.html";
  }, 2500);
}

// =========================================
// BUSCA DE CEP SUPER R√ÅPIDA + AUTO-PREENCHIMENTO
// =========================================
document.querySelector('input[placeholder="00000-000"]').addEventListener("input", function () {

  let cep = this.value.replace(/\D/g, '');

  if (cep.length <= 5) {
    this.value = cep;
  } else {
    this.value = cep.substring(0, 5) + "-" + cep.substring(5, 8);
  }

  if (cep.length === 8) {
    buscarCEP(cep);
  }
});

function buscarCEP(cep) {
  fetch(`https://viacep.com.br/ws/${cep}/json/`)
    .then(r => r.json())
    .then(data => {
      if (data.erro) {
        mostrarErro("CEP n√£o encontrado!");
        return;
      }

      preencherCampo("Rua", data.logradouro);
      preencherCampo("Bairro", data.bairro);
      preencherCampo("Cidade", data.localidade);
      preencherCampo("Estado", data.uf);
    })
    .catch(() => mostrarErro("Erro ao buscar CEP!"));
}

function preencherCampo(campo, valor) {
  const input = [...document.querySelectorAll("input")]
    .find(i => i.placeholder.toLowerCase() === campo.toLowerCase());

  if (input) input.value = valor;
}


</script>

</body>
</html>
